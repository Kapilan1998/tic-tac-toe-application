<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Tic-Tac-Toe</title>
    <link th:href="@{/css/toastr.css}" type="text/css" rel="stylesheet"/>
    <link th:href="@{/css/tictactoe.css}" type="text/css" rel="stylesheet"/>
    <link th:href="@{/css/finalDesign.css}" type="text/css" rel="stylesheet"/>
</head>
<body>
<div class="game-content">
    <div class="card">
        <div class="game-info">
            <div class="text-white">Player 1: <span id="player1" class="text-red"></span></div>
            <div class="text-white">Player 2: <span id="player2" class="text-red"></span></div>
            <div class="text-white">Turn: <span id="turn" class="text-red"></span></div>
            <div class="text-white">Winner: <span id="winner" class="text-red">-</span></div>
        </div>
        <div id="board">
            <div th:each="row, state : ${board}" th:class="${#strings.concat('row row-', state.index)}">
                <div th:each="cell, state2 : ${row}" th:class="${#strings.concat('cell cell-', state2.index)}">
                    <button th:if="${cell == ' '}" th:onclick="'makeMove(' + ${state2.index} + ')'"
                            th:text="' '"></button>
                    <span th:if="${cell != ' '}" th:text="${cell}"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/lib/sockjs.min.js}"></script>
<script th:src="@{/js/lib/stomp.min.js}"></script>
<script th:src="@{/js/lib/jquery-3.5.1.min.js}"></script>
<script th:src="@{/js/lib/toastr.js}"></script>
<script th:src="@{/js/tictactoe.js}"></script>

<div class="container mt-5">
    <button type="button" class="btn1-custom"
            style="
                background-color: #4CAF50; /* Green */
                border: none;
                color: white;
                padding: 15px 32px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin: 4px 2px;
                cursor: pointer;
                transition: background-color 0.3s, transform 0.3s;
            "
            onmouseover="this.style.backgroundColor='#45a049'; this.style.transform='scale(1.1)';"
            onmouseout="this.style.backgroundColor='#4CAF50'; this.style.transform='scale(1)';"
            onclick="fetchLastResults()"
    >
        See last results
    </button>
</div>

<!-- Beautiful Popup Box -->
<div id="popupBox" class="popup">
    <div class="popup-content" style="background-color: lightblue;">
        <span class="close" onclick="closePopupBox()">&times;</span>
        <pre id="popupContent"></pre>
    </div>
</div>
<script>
    async function fetchLastResults() {
        try {
            const response = await fetch('http://localhost:9000/api/v1/gameResult/showLastTenResult');
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            const data = await response.json();
            console.log(data);
            displayPopup(data);
        } catch (error) {
            console.error('There has been a problem with your fetch operation:', error);
        }
    }

    function displayPopup(data) {
        const popupContent = document.getElementById('popupContent');

        // Clear previous content
        popupContent.innerHTML = '';

        // Create table element
        const table = document.createElement('table');
        table.classList.add('table');

        // Create table header
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        const headers = ['Game Name', 'Winner'];
        headers.forEach(headerText => {
            const th = document.createElement('th');
            th.textContent = headerText;
            headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        // Create table body
        const tbody = document.createElement('tbody');
        data.forEach(item => {
            const row = document.createElement('tr');
            const gameNameCell = document.createElement('td');
            gameNameCell.textContent = item.gameName;
            const winnerCell = document.createElement('td');
            winnerCell.textContent = item.winner;
            row.appendChild(gameNameCell);
            row.appendChild(winnerCell);
            tbody.appendChild(row);
        });
        table.appendChild(tbody);

        // Append table to popup content
        popupContent.appendChild(table);

        // Show the popup box
        const popupBox = document.getElementById('popupBox');
        popupBox.style.display = 'block';
    }

    function closePopupBox() {
        const popupBox = document.getElementById('popupBox');
        popupBox.style.display = 'none'; // Hide the popup box
    }

</script>
</body>
</html>
